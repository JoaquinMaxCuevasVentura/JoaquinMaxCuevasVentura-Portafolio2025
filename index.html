<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="color-scheme" content="dark" />
  <meta name="theme-color" content="#050505" />

  <title>PORTAFOLIO 2025 | Joaquin Max Cuevas Ventura</title>

  <!-- Tailwind (requerido) -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

  <!-- Fuente Archivo -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;600;700&display=swap" rel="stylesheet" />

  <!-- Estilos dFlip -->
  <link href="https://cdn.jsdelivr.net/npm/dflip/css/dflip.min.css" rel="stylesheet" type="text/css" />
  <link href="https://cdn.jsdelivr.net/npm/dflip/css/themify-icons.min.css" rel="stylesheet" type="text/css" />

  <style>
    /* --- CONFIGURACIÓN VISUAL --- */
    :root {
      --bg-color: #222223;
      --accent-color: #dc6b2f;
      --text-main: #ffffff;
      --ui-opacity: 0.7;
    }

    html, body {
      height: 100%;
      margin: 0;
      background-color: var(--bg-color);
      font-family: 'Archivo', sans-serif !important;
      overflow: hidden;
    }

    /* Utilidad a11y */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Capa de Ruido */
    #grained-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
    }

    /* Capa del Libro */
    #flipbook-container {
      height: 100vh;
      width: 100vw;
      position: relative;
      z-index: 10;
    }

    /* --- INTERFAZ MINIMALISTA --- */
    .df-ui-wrapper {
      background: transparent !important;
      box-shadow: none !important;
      border: none !important;
      padding-bottom: 30px !important;
    }

    /* Botones Limpios */
    .df-ui-btn {
      background: transparent !important;
      border: none !important;
      box-shadow: none !important;
      color: var(--text-main) !important;
      border-radius: 0 !important;
      margin: 0 8px !important;
      transition: color 0.2s ease, opacity 0.2s ease, transform 0.2s ease, text-shadow 0.2s ease;
      opacity: var(--ui-opacity);
      width: auto !important;
      height: auto !important;
      padding: 0;
      line-height: 1;
    }

    /* Interacción (Naranja) */
    .df-ui-btn:hover,
    .df-ui-btn.active,
    .df-ui-btn.info-active {
      color: var(--accent-color) !important;
      background: transparent !important;
      opacity: 1 !important;
      transform: scale(1.3);
      text-shadow: 0 0 10px rgba(220, 107, 47, 0.5);
    }

    /* Focus visible (a11y sin alterar el look con mouse) */
    .df-ui-btn:focus-visible,
    .contact-link:focus-visible,
    .close-modal:focus-visible {
      outline: 2px solid var(--accent-color);
      outline-offset: 4px;
    }

    /* Corrección del Folio */
    .df-ui-page {
      width: auto !important;
      min-width: 0 !important;
      margin: 0 !important;
      background: transparent !important;
      box-shadow: none !important;
      border: none !important;
    }

    .df-ui-page input {
      width: 40px !important;
      text-align: center !important;
      background: transparent !important;
      border: none !important;
      color: var(--text-main) !important;
      font-family: 'Archivo', sans-serif !important;
      font-size: 12px !important;
      padding: 0 !important;
      height: 30px !important;
      box-shadow: none !important;
    }

    .df-ui-btn.df-ui-prev,
    .df-ui-btn.df-ui-next {
      margin: 0 2px !important;
    }

    /* --- GESTIÓN DE HIPERVÍNCULOS --- */
    .df-page-content .df-link,
    .df-page-content a {
      opacity: 0 !important;
      background: transparent !important;
      cursor: pointer !important;
    }

    .df-page-content .df-link:hover,
    .df-page-content a:hover {
      opacity: 0 !important;
    }

    /* --- VENTANA MODAL INFO (AJUSTADA) --- */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.96);
      z-index: 9999;
      justify-content: center;
      align-items: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .modal-overlay.show {
      display: flex;
      opacity: 1;
    }

    .modal-content {
      color: #fff;
      max-width: 500px;
      width: 85%;
      text-align: center;
      position: relative;
    }

    .modal-line {
      width: 40px;
      height: 2px;
      background-color: var(--accent-color);
      margin: 20px auto;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 2px;
      line-height: 1.2;
    }

    .modal-subtitle {
      font-size: 11px;
      color: var(--accent-color);
      margin-bottom: 30px;
      text-transform: uppercase;
      letter-spacing: 2px;
      font-weight: 600;
    }

    .modal-body {
      font-size: 14px;
      color: #ccc;
      line-height: 1.6;
      font-weight: 300;
    }

    .modal-contact {
      margin-top: 30px;
      border-top: 1px solid #222;
      padding-top: 25px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    /* --- ESTILOS DE CONTACTO (REDUCIDOS) --- */
    .contact-link {
      color: #666;
      text-decoration: none;
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      transition: 0.2s;
      cursor: pointer;
      padding: 0;

      /* Para que <button> y <a> se vean igual */
      background: transparent;
      border: 0;
      font: inherit;
      text-align: inherit;
    }

    .contact-link span {
      display: block;
      color: #fff;
      font-weight: 400;
      font-size: 14px;
      letter-spacing: 0.5px;
      margin-top: 4px;
      overflow-wrap: anywhere;
      word-break: break-word;
    }

    .contact-link:hover {
      color: var(--accent-color);
    }

    .contact-link:hover span {
      color: var(--accent-color);
    }

    .close-modal {
      position: absolute;
      top: -50px;
      right: 0;
      color: #666;
      font-size: 30px;
      cursor: pointer;
      transition: 0.2s;
      font-weight: 100;

      background: transparent;
      border: 0;
      padding: 0;
      line-height: 1;
    }

    .close-modal:hover {
      color: var(--accent-color);
    }

    .ti-info-custom:before {
      content: "\e645";
    }

    /* Responsividad extra para pantallas muy estrechas */
    @media (max-width: 360px) {
      .modal-content {
        width: 92%;
      }
      .close-modal {
        top: -44px;
      }
    }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce) {
      .df-ui-btn {
        transition: none;
      }
      .modal-overlay {
        transition: none;
      }
    }
  </style>
</head>
<body>
  <!-- FONDO -->
  <div id="grained-container" aria-hidden="true"></div>

  <!-- MODAL INFO -->
  <div
    id="infoModal"
    class="modal-overlay"
    role="dialog"
    aria-modal="true"
    aria-hidden="true"
    aria-labelledby="modalTitle"
    aria-describedby="modalDesc"
  >
    <div class="modal-content" tabindex="-1">
      <button id="closeModalBtn" type="button" class="close-modal" aria-label="Cerrar ventana de información">
        &times;
      </button>

      <div class="modal-title" id="modalTitle">JOAQUIN MAX<br />CUEVAS VENTURA</div>
      <div class="modal-subtitle">PORTAFOLIO 2025</div>

      <div class="modal-line" aria-hidden="true"></div>

      <div class="modal-body" id="modalDesc">
        <p>Arquitectura y diseño gráfico</p>

        <div class="modal-contact" aria-label="Datos de contacto">
          <!-- EMAIL -->
          <a
            href="mailto:JoACKo333@gmail.com"
            class="contact-link"
            title="Enviar correo"
            aria-label="Enviar correo a JoACKo333 arroba gmail punto com"
          >
            CORREO
            <span>JoACKo333@gmail.com</span>
          </a>

          <!-- TELÉFONO -->
          <button
            id="copyPhoneBtn"
            type="button"
            class="contact-link"
            title="Copiar número"
            aria-label="Copiar teléfono y WhatsApp al portapapeles"
          >
            TELÉFONO / WHATSAPP
            <span id="phone-display" aria-live="polite">+591 78834651</span>
          </button>

          <!-- UBICACIÓN -->
          <div class="contact-link" style="cursor: default; pointer-events: none;">
            La Paz, Bolivia
          </div>
        </div>

        <div id="copyStatus" class="sr-only" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <!-- LIBRO -->
  <div id="flipbook-container" aria-label="Visualizador de portafolio PDF"></div>

  <noscript>
    <div style="position: fixed; inset: 0; display: grid; place-items: center; color: #fff; background: #050505; z-index: 99999; padding: 24px; text-align: center;">
      Este portafolio requiere JavaScript para cargar el PDF interactivo.
    </div>
  </noscript>

  <!-- SCRIPTS (defer para no bloquear render; mantiene orden de ejecución) -->
  <script defer src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/dflip/js/dflip.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/grained/0.0.2/grained.min.js"></script>

  <script defer>
    (function () {
      'use strict';

      const PDF_NAME = 'PORTAFOLIO_2025_JoaquinMaxCuevasVentura_v01.pdf';
      const PHONE_TEXT = '+591 78834651';

      const modalOverlay = document.getElementById('infoModal');
      const modalContent = modalOverlay ? modalOverlay.querySelector('.modal-content') : null;
      const closeModalBtn = document.getElementById('closeModalBtn');
      const copyPhoneBtn = document.getElementById('copyPhoneBtn');
      const phoneDisplay = document.getElementById('phone-display');
      const copyStatus = document.getElementById('copyStatus');

      let lastFocusedEl = null;
      let infoToolbarBtn = null; // se define en onReady
      let phoneResetTimer = null;

      function isModalOpen() {
        return !!(modalOverlay && modalOverlay.classList.contains('show'));
      }

      function setInfoButtonExpanded(expanded) {
        if (!infoToolbarBtn) return;
        infoToolbarBtn.attr('aria-expanded', String(expanded));
      }

      function openModal() {
        if (!modalOverlay) return;

        lastFocusedEl = document.activeElement;

        modalOverlay.style.display = 'flex';
        modalOverlay.setAttribute('aria-hidden', 'false');
        // Forzar reflow mínimo para que la transición sea consistente
        void modalOverlay.offsetWidth;
        modalOverlay.classList.add('show');

        if (infoToolbarBtn) infoToolbarBtn.addClass('info-active');
        setInfoButtonExpanded(true);

        // Enfocar el contenido para lect. pantalla / teclado
        setTimeout(function () {
          if (modalContent) modalContent.focus();
        }, 0);
      }

      function closeModal() {
        if (!modalOverlay) return;

        modalOverlay.classList.remove('show');
        modalOverlay.setAttribute('aria-hidden', 'true');
        if (infoToolbarBtn) infoToolbarBtn.removeClass('info-active');
        setInfoButtonExpanded(false);

        window.setTimeout(function () {
          modalOverlay.style.display = 'none';
        }, 300);

        // Devolver foco
        window.setTimeout(function () {
          if (lastFocusedEl && typeof lastFocusedEl.focus === 'function') {
            lastFocusedEl.focus();
          }
        }, 0);
      }

      function toggleInfo() {
        if (isModalOpen()) closeModal();
        else openModal();
      }

      function getFocusableElements(container) {
        if (!container) return [];
        const selectors = [
          'a[href]',
          'button:not([disabled])',
          'input:not([disabled])',
          'select:not([disabled])',
          'textarea:not([disabled])',
          '[tabindex]:not([tabindex="-1"])'
        ];
        return Array.from(container.querySelectorAll(selectors.join(',')))
          .filter((el) => !el.hasAttribute('disabled') && el.offsetParent !== null);
      }

      function trapTabKey(e) {
        if (!isModalOpen() || e.key !== 'Tab' || !modalContent) return;

        const focusable = getFocusableElements(modalContent);
        if (focusable.length === 0) {
          e.preventDefault();
          modalContent.focus();
          return;
        }

        const first = focusable[0];
        const last = focusable[focusable.length - 1];
        const active = document.activeElement;

        if (e.shiftKey && active === first) {
          e.preventDefault();
          last.focus();
        } else if (!e.shiftKey && active === last) {
          e.preventDefault();
          first.focus();
        }
      }

      function announce(message) {
        if (copyStatus) copyStatus.textContent = message;
      }

      function setPhoneFeedback(message, ok) {
        if (!phoneDisplay) return;

        if (phoneResetTimer) {
          window.clearTimeout(phoneResetTimer);
          phoneResetTimer = null;
        }

        const originalText = PHONE_TEXT;
        phoneDisplay.textContent = message;
        phoneDisplay.style.color = ok ? 'var(--accent-color)' : '#999';
        phoneDisplay.style.fontWeight = ok ? '600' : '400';

        phoneResetTimer = window.setTimeout(function () {
          phoneDisplay.textContent = originalText;
          phoneDisplay.style.color = '';
          phoneDisplay.style.fontWeight = '400';
          phoneResetTimer = null;
        }, 2000);
      }

      async function copyTextToClipboard(text) {
        // Preferencia: Clipboard API (requiere contexto seguro)
        if (navigator.clipboard && window.isSecureContext) {
          await navigator.clipboard.writeText(text);
          return;
        }

        // Fallback (execCommand) para navegadores antiguos / contextos no seguros
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.setAttribute('readonly', '');
        ta.style.position = 'fixed';
        ta.style.top = '0';
        ta.style.left = '0';
        ta.style.opacity = '0';
        ta.style.pointerEvents = 'none';
        document.body.appendChild(ta);

        ta.select();
        ta.setSelectionRange(0, ta.value.length);

        let ok = false;
        try {
          ok = document.execCommand('copy');
        } finally {
          document.body.removeChild(ta);
        }
        if (!ok) throw new Error('execCommand(copy) no soportado o falló');
      }

      async function copyPhone() {
        try {
          await copyTextToClipboard(PHONE_TEXT);
          setPhoneFeedback('¡NÚMERO COPIADO!', true);
          announce('Número copiado al portapapeles');
        } catch (err) {
          console.warn('[copyPhone] No se pudo copiar al portapapeles:', err);
          setPhoneFeedback('NO SE PUDO COPIAR', false);
          announce('No se pudo copiar el número');
        }
      }

      function initGrain() {
        try {
          if (typeof grained !== 'function') {
            console.warn('[grained] Librería no disponible.');
            return;
          }
          grained('#grained-container', {
            animate: true,
            patternWidth: 100,
            patternHeight: 100,
            grainOpacity: 0.05,
            grainDensity: 1,
            grainWidth: 1,
            grainHeight: 1
          });
        } catch (e) {
          console.warn('[grained] Error inicializando textura:', e);
        }
      }

      function preflightPdfCheck() {
        // Validación suave: si falla, solo reporta en consola (sin romper UX).
        // En algunos entornos (file://) puede fallar por CORS, así que se hace best-effort.
        try {
          fetch(PDF_NAME, { method: 'HEAD', cache: 'no-store' })
            .then((res) => {
              if (!res.ok) {
                console.warn(`[dFlip] El PDF no respondió OK (status ${res.status}). Verifica ruta/nombre: ${PDF_NAME}`);
              }
            })
            .catch((err) => {
              console.warn('[dFlip] No se pudo validar el PDF vía HEAD (best-effort):', err);
            });
        } catch (e) {
          // Ignorar
        }
      }

      function initModalA11yHandlers() {
        if (!modalOverlay) return;

        // Click fuera del contenido
        modalOverlay.addEventListener('click', function (event) {
          if (event.target === modalOverlay) closeModal();
        }, { passive: true });

        // Teclado
        document.addEventListener('keydown', function (e) {
          if (!isModalOpen()) return;
          if (e.key === 'Escape') {
            e.preventDefault();
            closeModal();
          } else {
            trapTabKey(e);
          }
        });

        if (closeModalBtn) {
          closeModalBtn.addEventListener('click', function () {
            closeModal();
          });
        }
      }

      function initContactHandlers() {
        if (copyPhoneBtn) {
          copyPhoneBtn.addEventListener('click', function () {
            copyPhone();
          });
        }
      }

      function initFlipbook() {
        if (!window.jQuery) {
          console.error('[dFlip] jQuery no está disponible.');
          return;
        }

        const $ = window.jQuery;

        $(function () {
          preflightPdfCheck();

          const bookOptions = {
            source: PDF_NAME,
            webgl: true,
            height: '100%',
            duration: 700,
            backgroundColor: 'transparent',
            disableFolderPath: true,

            text: {
              toggleSound: 'SONIDO',
              toggleThumbnails: 'VISTA',
              toggleOutline: 'INDICE',
              previousPage: 'ANT',
              nextPage: 'SIG',
              toggleFullscreen: 'FULL',
              zoomIn: 'ZOOM +',
              zoomOut: 'ZOOM -'
            },

            allControls: 'altPrev,pageNumber,altNext,play,outline,thumbnail,zoomIn,zoomOut,fullScreen',
            hideControls: 'share,download,more',

            onReady: function () {
              // Botón custom INFO (a11y + teclado)
              infoToolbarBtn = $(
                '<button type="button" class="df-ui-btn df-ui-info" id="btn-info-custom" title="CONTACTO / INFO" aria-label="Contacto e información" aria-controls="infoModal" aria-expanded="false"><i class="ti-info-alt" aria-hidden="true"></i></button>'
              );

              infoToolbarBtn.on('click', function () {
                toggleInfo();
              });

              infoToolbarBtn.on('keydown', function (e) {
                // Enter / Space
                if (e.key === 'Enter' || e.key === ' ') {
                  e.preventDefault();
                  toggleInfo();
                }
              });

              const controls = $('.df-ui-wrapper');
              if (controls.length > 0) {
                controls.append(infoToolbarBtn);
              } else {
                console.warn('[dFlip] No se encontró .df-ui-wrapper para insertar el botón de info.');
              }
            },

            // dFlip podría ignorar opciones desconocidas; se agrega como manejo best-effort
            onError: function (err) {
              console.error('[dFlip] Error al cargar/renderizar el PDF:', err);
            }
          };

          try {
            $('#flipbook-container').flipBook(bookOptions.source, bookOptions);
          } catch (e) {
            console.error('[dFlip] Fallo al inicializar flipBook:', e);
          }
        });
      }

      // Init
      initGrain();
      initModalA11yHandlers();
      initContactHandlers();
      initFlipbook();
    })();
  </script>
</body>
</html>
